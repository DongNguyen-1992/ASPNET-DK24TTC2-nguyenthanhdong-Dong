@model IEnumerable<ProTechTiveGear.Models.Blog>

@{
    ViewBag.Title = "Quản Lý Tin Tức";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

<style>
    .stats-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 10px;
        padding: 20px;
        color: white;
        margin-bottom: 20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        transition: transform 0.3s ease;
    }
    
    .stats-card:hover {
        transform: translateY(-5px);
    }
    
    .stats-card.green {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    }
    
    .stats-card.orange {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    
    .stats-card.blue {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    
    .stats-number {
        font-size: 2.5rem;
        font-weight: bold;
        margin: 10px 0;
    }
    
    .stats-label {
        font-size: 0.9rem;
        opacity: 0.9;
    }
    
    .search-filter-card {
        background: white;
        border-radius: 10px;
        padding: 25px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .filter-row {
        display: flex;
        gap: 15px;
        align-items: end;
        flex-wrap: wrap;
    }
    
    .filter-group {
        flex: 1;
        min-width: 200px;
    }
    
    .filter-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
        color: #333;
    }
    
    .filter-group input,
    .filter-group select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 14px;
    }
    
    .btn-modern {
        padding: 10px 25px;
        border: none;
        border-radius: 5px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .btn-primary-modern {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .btn-primary-modern:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(102, 126, 234, 0.4);
    }
    
    .btn-success-modern {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
    }
    
    .btn-danger-modern {
        background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        color: white;
    }
    
    .table-modern {
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .table-modern thead {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .table-modern thead th {
        padding: 15px;
        font-weight: 500;
        border: none;
    }
    
    .table-modern tbody td {
        padding: 12px 15px;
        vertical-align: middle;
        border-bottom: 1px solid #f0f0f0;
    }
    
    .table-modern tbody tr:hover {
        background-color: #f8f9fa;
    }
    
    .blog-thumbnail {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .action-buttons {
        display: flex;
        gap: 8px;
    }
    
    .action-btn {
        padding: 6px 12px;
        border-radius: 5px;
        text-decoration: none;
        font-size: 13px;
        transition: all 0.3s ease;
        display: inline-block;
    }
    
    .action-btn:hover {
        transform: translateY(-2px);
        text-decoration: none;
    }
    
    .btn-edit {
        background: #ffc107;
        color: #333;
    }
    
    .btn-delete {
        background: #dc3545;
        color: white;
    }
    
    .btn-view {
        background: #17a2b8;
        color: white;
    }
    
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
    }
    
    .page-title {
        font-size: 2rem;
        font-weight: 600;
        color: #333;
        margin: 0;
    }
    
    .alert-modern {
        padding: 15px 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        border: none;
        animation: slideDown 0.3s ease;
    }
    
    @@keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .text-truncate-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
    }
</style>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-modern">
        <i class="fas fa-check-circle"></i> @TempData["SuccessMessage"]
    </div>
}

<div class="page-header">
    <h1 class="page-title">
        <i class="fas fa-newspaper"></i> Quản Lý Tin Tức
    </h1>
    <a href="@Url.Action("Create")" class="btn-modern btn-success-modern">
        <i class="fas fa-plus"></i> Thêm Tin Tức Mới
    </a>
</div>

<!-- Statistics Cards -->
<div class="row">
    <div class="col-md-4">
        <div class="stats-card">
            <div class="stats-label">
                <i class="fas fa-newspaper"></i> Tổng Số Tin Tức
            </div>
            <div class="stats-number">@ViewBag.TotalBlogs</div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="stats-card green">
            <div class="stats-label">
                <i class="fas fa-calendar-alt"></i> Tin Tức Tháng Này
            </div>
            <div class="stats-number">@ViewBag.ThisMonthBlogs</div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="stats-card orange">
            <div class="stats-label">
                <i class="fas fa-calendar-day"></i> Tin Tức Hôm Nay
            </div>
            <div class="stats-number">@ViewBag.TodayBlogs</div>
        </div>
    </div>
</div>

<!-- Search and Filter -->
<div class="search-filter-card">
    @using (Html.BeginForm("Index", "Blogs", FormMethod.Get))
    {
        <div class="filter-row">
            <div class="filter-group">
                <label>
                    <i class="fas fa-search"></i> Tìm Kiếm
                </label>
                <input type="text" 
                       name="searchString" 
                       value="@ViewBag.CurrentFilter" 
                       placeholder="Tìm theo tiêu đề, mô tả..." 
                       class="form-control" />
            </div>
            
            <div class="filter-group">
                <label>
                    <i class="fas fa-calendar"></i> Từ Ngày
                </label>
                <input type="date" 
                       name="fromDate" 
                       value="@(ViewBag.FromDate != null ? ((DateTime)ViewBag.FromDate).ToString("yyyy-MM-dd") : "")" 
                       class="form-control" />
            </div>
            
            <div class="filter-group">
                <label>
                    <i class="fas fa-calendar"></i> Đến Ngày
                </label>
                <input type="date" 
                       name="toDate" 
                       value="@(ViewBag.ToDate != null ? ((DateTime)ViewBag.ToDate).ToString("yyyy-MM-dd") : "")" 
                       class="form-control" />
            </div>
            
            <div class="filter-group">
                <label>
                    <i class="fas fa-sort"></i> Sắp Xếp
                </label>
                <select name="sortOrder" class="form-control">
                    <option value="">Tiêu đề (A-Z)</option>
                    <option value="title_desc">Tiêu đề (Z-A)</option>
                    <option value="Date">Ngày cũ nhất</option>
                    <option value="date_desc">Ngày mới nhất</option>
                </select>
            </div>
            
            <div class="filter-group" style="flex: 0;">
                <button type="submit" class="btn-modern btn-primary-modern">
                    <i class="fas fa-filter"></i> Lọc
                </button>
            </div>
        </div>
    }
</div>

<!-- Blogs Table -->
<div class="card shadow mb-4">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-modern" id="dataTable">
                <thead>
                    <tr>
                        <th style="width: 100px;">Ảnh</th>
                        <th>Tiêu Đề</th>
                        <th style="width: 120px;">Ngày Đăng</th>
                        <th>Mô Tả Ngắn</th>
                        <th style="width: 200px; text-align: center;">Thao Tác</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null && Model.Any())
                    {
                        foreach (var item in Model)
                        {
                            <tr>
                                <td>
                                    @if (!string.IsNullOrEmpty(item.Picture))
                                    {
                                        <img src="~/img/Item/@item.Picture" alt="@item.Title" class="blog-thumbnail" />
                                    }
                                    else
                                    {
                                        <img src="~/img/Item/default-blog.jpg" alt="No Image" class="blog-thumbnail" />
                                    }
                                </td>
                                <td>
                                    <strong>@item.Title</strong>
                                </td>
                                <td>
                                    @if (item.DateImport.HasValue)
                                    {
                                        <small>@item.DateImport.Value.ToString("dd/MM/yyyy")</small>
                                    }
                                    else
                                    {
                                        <small class="text-muted">Chưa có</small>
                                    }
                                </td>
                                <td>
                                    <div class="text-truncate-2">
                                        @item.ShortTitle
                                    </div>
                                </td>
                                <td style="text-align: center;">
                                    <div class="action-buttons" style="justify-content: center;">
                                        <a href="@Url.Action("Details", new { id = item.ID })" 
                                           class="action-btn btn-view" 
                                           title="Xem chi tiết">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a href="@Url.Action("Edit", new { id = item.ID })" 
                                           class="action-btn btn-edit" 
                                           title="Chỉnh sửa">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <a href="@Url.Action("Delete", new { id = item.ID })" 
                                           class="action-btn btn-delete" 
                                           title="Xóa">
                                            <i class="fas fa-trash"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 40px;">
                                <i class="fas fa-inbox" style="font-size: 3rem; color: #ccc;"></i>
                                <p style="margin-top: 15px; color: #999;">Không có tin tức nào</p>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Check if DataTable is already initialized
            if ($.fn.DataTable.isDataTable('#dataTable')) {
                $('#dataTable').DataTable().destroy();
            }

            // Initialize DataTable with custom options
            $('#dataTable').DataTable({
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/1.10.24/i18n/Vietnamese.json"
                },
                "pageLength": 10,
                "ordering": false,
                "searching": false
            });

            // Auto-hide success message
            setTimeout(function() {
                $('.alert-modern').fadeOut('slow');
            }, 3000);
        });
    </script>
}